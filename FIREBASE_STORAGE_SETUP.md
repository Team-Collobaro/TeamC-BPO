# Firebase Storage Setup Guide

To enable thumbnail uploads (and other file uploads), you need to enable Firebase Storage and configure security rules.

## Step 1: Enable Firebase Storage

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project
3. Navigate to **Storage** in the left sidebar
4. Click **"Get Started"** or **"Create bucket"**
5. Choose **"Start in production mode"** (we'll add rules next)
6. Select a location (choose the same region as your Firestore database)
7. Click **"Done"**

## Step 2: Deploy Storage Rules

The `storage.rules` file has been created with the following permissions:

- **Module thumbnails**: Admin can upload, authenticated users can read
- **CVs**: Candidates can upload their own, employers with subscription and admin can read
- **Certificates**: Users can read their own, admin can read all

Deploy the rules:

```bash
firebase deploy --only storage
```

Or deploy everything:

```bash
firebase deploy
```

## Step 3: Verify Storage Configuration

1. Go to Firebase Console → **Storage**
2. Click on **"Rules"** tab
3. Verify the rules are deployed correctly
4. You should see rules similar to:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /module-thumbnails/{courseId}/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.role == 'admin';
    }
    // ... other rules
  }
}
```

## Step 4: Test Thumbnail Upload

1. Login as admin
2. Go to Admin Panel → Courses & Library
3. Add or edit a module
4. Upload a thumbnail image
5. Check Firebase Console → Storage → `module-thumbnails/` folder
6. The image should appear there

## Storage Structure

Files are organized as follows:

```
storage/
├── module-thumbnails/
│   └── {courseId}/
│       └── {timestamp}_{filename}
├── cvs/
│   └── {userId}/
│       └── {timestamp}_{filename}
└── certificates/
    └── {userId}/
        └── {filename}
```

## Troubleshooting

### "Permission denied" error when uploading
- Make sure you're logged in as admin
- Verify storage rules are deployed: `firebase deploy --only storage`
- Check Firebase Console → Storage → Rules to see current rules

### "Storage not initialized" error
- Check `.env.local` has `VITE_FIREBASE_STORAGE_BUCKET` set
- Restart dev server after adding the env variable

### Storage bucket not found
- Make sure Storage is enabled in Firebase Console
- Verify the bucket name matches `VITE_FIREBASE_STORAGE_BUCKET` in `.env.local`

## Environment Variable

Make sure your `.env.local` includes:

```env
VITE_FIREBASE_STORAGE_BUCKET=your-project-id.appspot.com
```

This is usually included in your Firebase config. You can find it in:
- Firebase Console → Project Settings → General → Your apps → Web app config

## Security Notes

- Admin-only uploads for module thumbnails (prevents unauthorized uploads)
- Users can only read thumbnails (cannot modify or delete)
- CVs are user-specific (candidates upload their own)
- Certificates are read-only for users (generated by Cloud Functions)
